services:
  discordmanager:
    build: .
    image: discordmanager:latest
    container_name: discordmanager
    # Run as host user to avoid permission issues with mounted volumes
    # UID and GID are set by launch.sh script to match your host user
    # Falls back to 1000:1000 (common Linux default) if not set
    # macOS users typically have UID=501, GID=20 which will be used when running via ./scripts/launch.sh
    user: "${UID:-1000}:${GID:-1000}"
    volumes:
      # Mount your Discord data package
      # IMPORTANT: Place your extracted Discord data package in ./data/package/
      # It should contain: messages/, account/, servers/, etc.
      # To use a different location, change the path before the colon:
      # - /your/custom/path:/data/package
      - ./data/package:/data/package
      # Mount config directory (contains config.json, .env, etc.)
      - ./config:/app/config
      # Mount export directory for exported DMs
      - ./export:/app/export
      # Mount logs directory
      - ./logs:/app/logs
    environment:
      # These can override values in config/.env
      - NODE_ENV=production
      # Optional: Set dry run mode
      # - DRY_RUN=false
    # Default command - override with docker compose run args
    command: ["--help"]
    stdin_open: true
    tty: true

# Example usage:
# 
# 1. Interactive menu mode (for configuration):
#    docker compose run --rm discordmanager interactive
#
# 2. Export specific users by username:
#    docker compose run --rm discordmanager -s username1 username2
#
# 3. Export specific user IDs:
#    docker compose run --rm discordmanager -u 123456789 987654321
#
# 4. Export all DMs:
#    docker compose run --rm discordmanager --all
#
# 5. Batch mode:
#    docker compose run --rm discordmanager batch
